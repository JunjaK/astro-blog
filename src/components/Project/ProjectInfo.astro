---
import fs from 'node:fs';
import path from 'node:path';
import type { ProjectInfo } from '@/types/commonType.ts';
import ImageLoader from '../Blog/ImageLoader.astro';

interface Props {
  frontmatter: ProjectInfo;
}

const { frontmatter } = Astro.props;

function resolveOriginalImage(thumbnail: string | undefined): string | undefined {
  if (!thumbnail) return undefined;
  const basePath = thumbnail.replace(/-thumb\.webp$/, '');
  if (basePath === thumbnail) return thumbnail;
  const localBase = path.resolve('image-assets', basePath.replace(/^\/files\//, ''));
  for (const ext of ['.png', '.jpeg', '.jpg', '.webp', '.gif']) {
    if (fs.existsSync(localBase + ext)) return basePath + ext;
  }
  return thumbnail;
}

const originalImage = resolveOriginalImage(frontmatter.thumbnail);
---

<Fragment>
  <ImageLoader src={originalImage} alt={frontmatter.title} />
  <div class="project-info">
    <h1>{frontmatter.title}</h1>
    <p>{frontmatter.duration}</p>
  </div>
</Fragment>

